<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Enhance App - Fitur Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .loader {
            border: 5px solid #f3f3f3; /* Light grey */
            border-top: 5px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        .loader_small { /* Loader yang lebih kecil untuk fitur per item */
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .output-box-container { 
            /* Styles for the container of multiple variations if needed */
        }
        .variation-item {
            background-color: #374151; /* bg-slate-700 */
            padding: 1rem; /* p-4 */
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 1px 3px 0 rgba(0,0,0,.1), 0 1px 2px -1px rgba(0,0,0,.1); /* shadow */
            margin-bottom: 1rem; /* mb-4 */
            position: relative;
        }
        .variation-item pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
            color: #d1d5db; /* text-slate-300 */
            min-height: 60px; /* Minimum height for each variation */
        }
        .copy-button {
            transition: all 0.2s ease-in-out;
            position: absolute;
            top: 0.5rem; /* top-2 */
            right: 0.5rem; /* right-2 */
            background-color: #4b5563; /* bg-slate-600 */
            padding: 0.5rem; /* p-2 */
            border-radius: 0.375rem; /* rounded-md */
        }
        .copy-button:hover {
            transform: scale(1.05);
            background-color: #6b7280; /* hover:bg-slate-500 */
        }
        .copy-button:active {
            transform: scale(0.95);
        }
        .copied-feedback {
            transition: opacity 0.5s ease-in-out;
            position: absolute;
            top: 2.75rem; /* Adjusted position */
            right: 0.5rem; /* right-2 */
            font-size: 0.75rem; /* text-xs */
            background-color: #10b981; /* bg-green-500 */
            color: white;
            padding: 0.25rem 0.5rem; /* px-2 py-1 */
            border-radius: 0.25rem; /* rounded */
            opacity: 0;
        }
        .feature-button { /* Tombol untuk fitur tambahan per variasi */
            margin-top: 0.5rem; /* mt-2 */
            font-size: 0.75rem; /* text-xs */
            font-weight: 600; /* font-semibold */
            padding: 0.25rem 0.5rem; /* py-1 px-2 */
            border-radius: 0.375rem; /* rounded-md */
            color: white;
            transition: background-color 0.15s ease-in-out;
        }
        .feature-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .feature-result { /* Kontainer untuk hasil fitur tambahan */
            margin-top: 0.5rem; /* mt-2 */
            padding: 0.5rem; /* p-2 */
            background-color: #4b5563; /* bg-slate-600 equivalent */
            border-radius: 0.25rem; /* rounded */
            font-size: 0.75rem; /* text-xs */
            color: #e5e7eb; /* text-slate-200 roughly */
            white-space: pre-wrap;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 to-slate-800 text-white min-h-screen flex flex-col items-center justify-center p-4 selection:bg-sky-500 selection:text-white">

    <div class="bg-slate-800 p-6 sm:p-8 rounded-xl shadow-2xl w-full max-w-3xl"> <header class="mb-6 text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-sky-400">üöÄ Prompt Enhance Pro</h1>
            <p class="text-slate-400 mt-2">Sempurnakan, analisis, dan kembangkan ide prompt Anda untuk gambar dan video.</p>
        </header>

        <main>
            <div class="mb-4"> <label for="userPrompt" class="block text-sm font-medium text-slate-300 mb-1">Masukkan Prompt Sederhana Anda:</label>
                <textarea id="userPrompt" rows="3" class="w-full p-3 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 placeholder-slate-500 text-slate-200 resize-none" placeholder="Contoh: seekor naga di atas gunung"></textarea>
            </div>
            
            <button id="analyzeOriginalPromptButton" class="mb-4 w-full sm:w-auto bg-teal-500 hover:bg-teal-600 text-white font-semibold py-2 px-4 rounded-lg text-sm shadow-md hover:shadow-lg transition duration-150 ease-in-out">
                ‚ú® Analisis Prompt Saya
            </button>
            <div id="originalPromptAnalysisResult" class="hidden mb-4 p-3 bg-slate-700 rounded-lg text-sm shadow">
                <h4 class="font-semibold text-sky-300 mb-1">üîç Hasil Analisis Prompt Awal:</h4>
                <div id="originalPromptAnalysisLoader" class="hidden loader_small mx-auto my-2"></div>
                <p id="originalPromptAnalysisText" class="text-slate-300 whitespace-pre-wrap"></p>
            </div>

            <button id="enhanceButton" class="w-full bg-sky-500 hover:bg-sky-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:shadow-lg transition duration-150 ease-in-out transform hover:scale-105 active:scale-95">
                Sempurnakan (5 Variasi) ‚ú®
            </button>

            <div id="loadingAnimation" class="hidden my-6">
                <div class="loader"></div>
                <p class="text-center text-slate-400">Sedang memproses 5 variasi untuk Anda...</p>
            </div>

            <div id="results" class="hidden mt-8 space-y-6">
                <div>
                    <h2 class="text-xl sm:text-2xl font-semibold text-sky-400 mb-3">üñºÔ∏è Hasil Prompt Gambar (5 Variasi Bahasa Inggris):</h2>
                    <div id="imagePromptOutputContainer" class="output-box-container space-y-4">
                        {/* Variasi prompt gambar akan dimasukkan di sini */}
                    </div>
                </div>

                <div>
                    <h2 class="text-xl sm:text-2xl font-semibold text-sky-400 mb-3">üé¨ Hasil Prompt Adegan Video (5 Variasi Bahasa Inggris):</h2>
                    <div id="videoPromptOutputContainer" class="output-box-container space-y-4">
                        {/* Variasi prompt video akan dimasukkan di sini */}
                    </div>
                </div>
            </div>
            <div id="errorMessage" class="hidden mt-6 p-4 bg-red-500/30 text-red-400 border border-red-500 rounded-lg">
                <p id="errorMessageText"></p>
            </div>
        </main>
        <footer class="text-center mt-8 text-sm text-slate-500">
            Ditenagai oleh Gemini API & Tailwind CSS
        </footer>
    </div>

    <script>
        const userPromptInput = document.getElementById('userPrompt');
        const enhanceButton = document.getElementById('enhanceButton');
        const loadingAnimation = document.getElementById('loadingAnimation');
        const resultsDiv = document.getElementById('results');
        const imagePromptOutputContainer = document.getElementById('imagePromptOutputContainer');
        const videoPromptOutputContainer = document.getElementById('videoPromptOutputContainer');
        const errorMessageDiv = document.getElementById('errorMessage');
        const errorMessageText = document.getElementById('errorMessageText');

        const analyzeOriginalPromptButton = document.getElementById('analyzeOriginalPromptButton');
        const originalPromptAnalysisResultDiv = document.getElementById('originalPromptAnalysisResult');
        const originalPromptAnalysisText = document.getElementById('originalPromptAnalysisText');
        const originalPromptAnalysisLoader = document.getElementById('originalPromptAnalysisLoader');

        const apiKey = ""; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

        analyzeOriginalPromptButton.addEventListener('click', async () => {
            const simplePrompt = userPromptInput.value.trim();
            if (!simplePrompt) {
                originalPromptAnalysisResultDiv.classList.remove('hidden');
                originalPromptAnalysisText.textContent = "Masukkan prompt terlebih dahulu untuk dianalisis.";
                originalPromptAnalysisLoader.classList.add('hidden');
                return;
            }

            originalPromptAnalysisResultDiv.classList.remove('hidden');
            originalPromptAnalysisText.textContent = ''; 
            originalPromptAnalysisLoader.classList.remove('hidden');
            analyzeOriginalPromptButton.disabled = true;
            analyzeOriginalPromptButton.classList.add('opacity-50');

            const instruction = `Anda adalah asisten ahli prompt. Analisis prompt pengguna berikut: '${simplePrompt}'.
Berikan masukan konstruktif tentang kejelasan, kekhususan, dan potensi untuk menghasilkan hasil yang baik dengan generator gambar atau video AI.
Sarankan 1-2 cara spesifik pengguna dapat meningkatkan atau menguraikan prompt ini jika mereka mau.
Jaga analisis Anda tetap ringkas dan dapat ditindaklanjuti, dalam 2-4 kalimat. Balas dalam Bahasa Indonesia.`;

            try {
                const analysis = await generateGeminiResponse(instruction);
                originalPromptAnalysisText.textContent = analysis;
            } catch (error) {
                console.error("Error menganalisis prompt:", error);
                originalPromptAnalysisText.textContent = "Gagal menganalisis prompt: " + error.message;
            } finally {
                originalPromptAnalysisLoader.classList.add('hidden');
                analyzeOriginalPromptButton.disabled = false;
                analyzeOriginalPromptButton.classList.remove('opacity-50');
            }
        });

        enhanceButton.addEventListener('click', async () => {
            const simplePrompt = userPromptInput.value.trim();
            if (!simplePrompt) {
                displayError("Harap masukkan prompt terlebih dahulu.");
                return;
            }

            loadingAnimation.classList.remove('hidden');
            resultsDiv.classList.add('hidden');
            errorMessageDiv.classList.add('hidden');
            enhanceButton.disabled = true;
            enhanceButton.classList.add('opacity-50', 'cursor-not-allowed');
            
            imagePromptOutputContainer.innerHTML = '';
            videoPromptOutputContainer.innerHTML = '';

            try {
                const imagePromptInstruction = `You are an AI assistant that refines simple user prompts into slightly more detailed and evocative prompts for image generation.
Focus on the core elements of the user's input: '${simplePrompt}'.
Enhance it by:
1.  Adding 2-3 key descriptive adjectives or short phrases that clarify the subject and its immediate environment.
2.  Suggesting a general artistic mood or style that complements the original idea (e.g., "dreamy atmosphere," "sharp focus," "vintage photo look," "impressionistic").
3.  Briefly mentioning dominant colors or lighting if it significantly enhances the core concept.
Keep each prompt concise and directly related to the user's original request. Avoid introducing entirely new subjects or complex scenarios.
Provide 5 distinct variations of the enhanced prompt. Each variation should ONLY contain the enhanced prompt itself, starting on a new line with a number and a period (e.g., '1. Enhanced prompt text A', '2. Enhanced prompt text B', ... '5. Enhanced prompt text E'). Do not include any other conversational text or repeat the user's original prompt within the numbered variations. Reply in English for each prompt variation.`;

                const videoPromptInstruction = `You are an AI assistant that refines simple user prompts into slightly more detailed and focused video scene descriptions.
Focus on the core elements of the user's input: '${simplePrompt}'.
Enhance it by:
1.  Briefly describing the key action or state of the main subject(s).
2.  Adding 1-2 details about the immediate setting or atmosphere directly relevant to the user's prompt.
3.  Suggesting a simple camera shot or angle that would best capture the essence of the scene (e.g., "close-up on the character's expression," "wide shot showing the landscape," "slow pan across the object").
4.  Mentioning a key sound element or overall mood if it's crucial to the user's original idea.
Keep each scene description concise and directly related to the user's original request. Avoid creating complex narratives or adding characters/elements not implied by the initial prompt.
Provide 5 distinct variations of the enhanced scene description. Each variation should ONLY contain the enhanced scene description itself, starting on a new line with a number and a period (e.g., '1. Enhanced scene description A', '2. Enhanced scene description B', ... '5. Enhanced scene description E'). Do not include any other conversational text or repeat the user's original prompt within the numbered variations. Reply in English for each scene description variation.`;

                const imageEnhancedPromptsText = await generateGeminiResponse(imagePromptInstruction);
                const videoEnhancedPromptsText = await generateGeminiResponse(videoPromptInstruction);

                displayVariations(imagePromptOutputContainer, imageEnhancedPromptsText, 'image');
                displayVariations(videoPromptOutputContainer, videoEnhancedPromptsText, 'video');
                
                resultsDiv.classList.remove('hidden');

            } catch (error) {
                console.error("Error:", error);
                displayError("Terjadi kesalahan saat memproses permintaan Anda. Silakan coba lagi. Detail: " + error.message);
            } finally {
                loadingAnimation.classList.add('hidden');
                enhanceButton.disabled = false;
                enhanceButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        });

        async function generateGeminiResponse(instruction) { 
            const payload = {
                contents: [{ role: "user", parts: [{ text: instruction }] }]
            };
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    const errorBody = await response.json();
                    throw new Error(`Permintaan API gagal: ${response.status} ${errorBody?.error?.message || response.statusText}`);
                }
                const result = await response.json();
                if (result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    console.warn("Struktur respons API tidak terduga:", result);
                    return "Format respons tidak terduga dari API atau tidak ada konten yang dihasilkan.";
                }
            } catch (error) {
                console.error("Error memanggil Gemini API:", error);
                throw error;
            }
        }

        function displayVariations(container, variationsText, type) {
            container.innerHTML = ''; 
            if (!variationsText || typeof variationsText !== 'string' || variationsText.toLowerCase().includes("tidak terduga dari api")) {
                container.innerHTML = `<p class="text-slate-400">Tidak ada variasi ${type} yang dapat ditampilkan atau terjadi kesalahan format.</p>`;
                if (variationsText) console.log("Raw variations text for " + type + ":", variationsText);
                return;
            }

            const rawVariations = variationsText.split(/\n\s*(?=\d+\.\s)/);
            
            let finalVariations = [];
            if (rawVariations.length > 0 && rawVariations[0].match(/^\s*\d+\.\s/)) {
                finalVariations = rawVariations.map(v => v.trim()).filter(v => v);
            } else if (rawVariations.length > 0) {
                const firstVariationMatch = rawVariations[0].match(/(\d+\.\s.*)/s);
                if (firstVariationMatch && firstVariationMatch[1]) {
                    finalVariations.push(firstVariationMatch[1].trim());
                }
                if (rawVariations.length > 1) {
                    finalVariations.push(...rawVariations.slice(1).map(v => v.trim()).filter(v => v));
                }
            }
            
            if (finalVariations.length === 0 && variationsText.includes('\n')) { 
                 finalVariations = variationsText.split('\n').map(v => v.trim()).filter(v => v.replace(/^\d+\.\s*/, '').trim() !== "");
            } else if (finalVariations.length === 0 && variationsText.trim() !== "") {
                 finalVariations = [variationsText.trim()]; 
            }


            if (finalVariations.length === 0) {
                 container.innerHTML = `<p class="text-slate-400">Tidak ada variasi ${type} yang valid ditemukan dalam respons.</p>`;
                 return;
            }

            finalVariations.slice(0, 5).forEach((variation, index) => {
                let cleanedVariation = variation;
                const match = cleanedVariation.match(/(?:\d+\.\s)?(.*)/s);
                if (match && match[1]) {
                    cleanedVariation = match[1].trim();
                } else {
                     cleanedVariation = cleanedVariation.replace(/^\d+\.\s*/, '').trim();
                }

                if (!cleanedVariation.trim()) return; 

                const variationId = `${type}-variation-${index}`;
                const feedbackId = `${type}-feedback-${index}`;
                const featureResultId = `${type}-feature-result-${index}`;
                const featureLoaderId = `${type}-feature-loader-${index}`;
                const featureButtonId = `${type}-feature-button-${index}`;

                const itemDiv = document.createElement('div');
                itemDiv.className = 'variation-item';

                const pre = document.createElement('pre');
                pre.id = variationId;
                pre.textContent = cleanedVariation;
                
                const copyBtn = document.createElement('button');
                copyBtn.className = 'copy-button text-slate-300';
                copyBtn.title = `Salin Variasi ${type} ${index + 1}`;
                copyBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>`;
                copyBtn.onclick = () => copyToClipboard(variationId, feedbackId);

                const feedbackSpan = document.createElement('span');
                feedbackSpan.id = feedbackId;
                feedbackSpan.className = 'copied-feedback';
                feedbackSpan.textContent = 'Disalin!';

                itemDiv.appendChild(pre);
                itemDiv.appendChild(copyBtn);
                itemDiv.appendChild(feedbackSpan);

                const featureButton = document.createElement('button');
                featureButton.id = featureButtonId;
                const featureResultDiv = document.createElement('div');
                const featureLoader = document.createElement('div');

                featureResultDiv.id = featureResultId;
                featureResultDiv.className = 'hidden feature-result'; 
                featureLoader.id = featureLoaderId;
                featureLoader.className = 'hidden loader_small mx-auto my-1';

                if (type === 'image') {
                    featureButton.innerHTML = '‚ú® Deskripsikan Gaya Visual';
                    featureButton.className = 'feature-button bg-indigo-500 hover:bg-indigo-600';
                    featureButton.onclick = () => describeVisualStyle(cleanedVariation, featureResultId, featureLoaderId, featureButton);
                } else { 
                    featureButton.innerHTML = '‚ú® Kembangkan Mini-Narasi';
                    featureButton.className = 'feature-button bg-purple-500 hover:bg-purple-600';
                    featureButton.onclick = () => developMiniNarrative(cleanedVariation, featureResultId, featureLoaderId, featureButton);
                }
                
                itemDiv.appendChild(featureButton);
                itemDiv.appendChild(featureLoader);
                itemDiv.appendChild(featureResultDiv);

                container.appendChild(itemDiv);
            });
             if (finalVariations.length === 0 && !variationsText.toLowerCase().includes("tidak dapat menghasilkan")) {
                container.innerHTML = `<p class="text-slate-400">Gagal mem-parsing variasi ${type}.</p>`;
            }
        }
        
        async function describeVisualStyle(imagePrompt, resultElementId, loaderElementId, buttonElement) {
            const resultEl = document.getElementById(resultElementId);
            const loaderEl = document.getElementById(loaderElementId);

            resultEl.classList.add('hidden');
            resultEl.textContent = '';
            loaderEl.classList.remove('hidden');
            buttonElement.disabled = true;
            buttonElement.classList.add('opacity-50');

            const instruction = `Berdasarkan prompt gambar berikut: '${imagePrompt}', berikan deskripsi ringkas (2-3 kalimat) tentang kemungkinan gaya visual, suasana hati, dan elemen artistik utama yang tersirat. Misalnya, sebutkan apakah itu menyarankan fotorealisme, seni fantasi, palet warna tertentu, kondisi pencahayaan, atau pengaruh artistik tertentu. Balas dalam Bahasa Indonesia.`;

            try {
                const description = await generateGeminiResponse(instruction);
                resultEl.textContent = description;
                resultEl.classList.remove('hidden');
            } catch (error) {
                console.error("Error mendeskripsikan gaya visual:", error);
                resultEl.textContent = "Gagal mendeskripsikan gaya visual: " + error.message;
                resultEl.classList.remove('hidden');
            } finally {
                loaderEl.classList.add('hidden');
                buttonElement.disabled = false;
                buttonElement.classList.remove('opacity-50');
            }
        }

        async function developMiniNarrative(videoPrompt, resultElementId, loaderElementId, buttonElement) {
            const resultEl = document.getElementById(resultElementId);
            const loaderEl = document.getElementById(loaderElementId);

            resultEl.classList.add('hidden');
            resultEl.textContent = '';
            loaderEl.classList.remove('hidden');
            buttonElement.disabled = true;
            buttonElement.classList.add('opacity-50');

            const instruction = `Berdasarkan deskripsi adegan video berikut: '${videoPrompt}', kembangkan mini-narasi yang sangat singkat (1-2 kalimat). Ini bisa berupa kemungkinan peristiwa sebelumnya, konsekuensi langsung, atau perluasan singkat dari implikasi adegan saat ini. Jaga agar tetap ringkas dan kreatif. Balas dalam Bahasa Indonesia.`;

            try {
                const narrative = await generateGeminiResponse(instruction);
                resultEl.textContent = narrative;
                resultEl.classList.remove('hidden');
            } catch (error) {
                console.error("Error mengembangkan narasi:", error);
                resultEl.textContent = "Gagal mengembangkan narasi: " + error.message;
                resultEl.classList.remove('hidden');
            } finally {
                loaderEl.classList.add('hidden');
                buttonElement.disabled = false;
                buttonElement.classList.remove('opacity-50');
            }
        }

        function displayError(message) {
            errorMessageText.textContent = message;
            errorMessageDiv.classList.remove('hidden');
            resultsDiv.classList.add('hidden');
        }

        function copyToClipboard(elementId, feedbackElementId) {
            const textToCopy = document.getElementById(elementId).textContent;
            const textArea = document.createElement("textarea");
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                const feedbackEl = document.getElementById(feedbackElementId);
                feedbackEl.style.opacity = '1';
                setTimeout(() => {
                    feedbackEl.style.opacity = '0';
                }, 1500);
            } catch (err) {
                console.error('Fallback: Gagal menyalin', err);
                const feedbackEl = document.getElementById(feedbackElementId);
                if (feedbackEl) {
                    feedbackEl.textContent = 'Gagal!';
                    feedbackEl.style.backgroundColor = 'red'; 
                    feedbackEl.style.opacity = '1';
                     setTimeout(() => {
                        feedbackEl.style.opacity = '0';
                        setTimeout(() => {
                            feedbackEl.textContent = 'Disalin!';
                            feedbackEl.style.backgroundColor = '#10b981'; 
                        }, 500);
                    }, 2000);
                }
            }
            document.body.removeChild(textArea);
        }
    </script>
</body>
</html>
